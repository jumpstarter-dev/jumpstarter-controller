{
  "$schema": "http://json-schema.org/draft-06/schema#",
  "$defs": {
    "port": {
      "type": "integer",
      "minimum": 0,
      "maximum": 65535
    },
    "labels": {
      "type": "object",
      "additionalProperties": {
        "type": [
          "string",
          "null"
        ]
      }
    },
    "ClusterIP": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "type": {
          "type": "string",
          "const": "ClusterIP"
        }
      }
    },
    "NodePort": {
      "type": "object",
      "required": [
        "type",
        "nodePort"
      ],
      "additionalProperties": false,
      "properties": {
        "type": {
          "type": "string",
          "const": "NodePort"
        },
        "nodePort": {
          "$ref": "#/$defs/port"
        }
      }
    },
    "service": {
      "anyOf": [
        {
          "$ref": "#/$defs/ClusterIP"
        },
        {
          "$ref": "#/$defs/NodePort"
        }
      ]
    },
    "ingress": {
      "enabled": {
        "type": "boolean",
        "description": "Whether to enable Ingress for the gRPC endpoint"
      },
      "class": {
        "type": "string",
        "description": "IngressClass to use for the gRPC endpoint"
      }
    },
    "route": {
      "enabled": {
        "type": "boolean",
        "description": "Whether to enable OpenShift Router for the gRPC endpoint"
      }
    },
    "router": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "hostname": {
          "type": "string",
          "description": "Hostname for the gRPC router endpoint selfsigned certificates"
        },
        "endpoint": {
          "type": "string",
          "description": "Endpoint to advertise for the gRPC router endpoint"
        },
        "ingress": {
          "$ref": "#/$defs/ingress"
        },
        "route": {
          "$ref": "#/$defs/route"
        },
        "service": {
          "$ref": "#/$defs/service"
        },
        "labels": {
          "$ref": "#/$defs/labels"
        }
      }
    },
    "PrefixedClaimOrExpression": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "claim": {
          "type": "string"
        },
        "prefix": {
          "type": "string"
        },
        "expression": {
          "type": "string"
        }
      }
    },
    "ClaimOrExpression": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "claim": {
          "type": "string"
        },
        "expression": {
          "type": "string"
        }
      }
    },
    "JWTAuthenticator": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "issuer": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "url": {
              "type": "string"
            },
            "discoveryURL": {
              "type": "string"
            },
            "certificateAuthority": {
              "type": "string"
            },
            "audiences": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "audienceMatchPolicy": {
              "type": "string",
              "enum": [
                "MatchAny"
              ]
            }
          }
        },
        "claimValidationRules": {
          "type": "array",
          "items": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
              "claim": {
                "type": "string"
              },
              "requiredValue": {
                "type": "string"
              },
              "expression": {
                "type": "string"
              },
              "message": {
                "type": "string"
              }
            }
          }
        },
        "claimMappings": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "username": {
              "$ref": "#/$defs/PrefixedClaimOrExpression"
            },
            "groups": {
              "$ref": "#/$defs/PrefixedClaimOrExpression"
            },
            "uid": {
              "$ref": "#/$defs/ClaimOrExpression"
            },
            "extra": {
              "type": "array",
              "items": {
                "type": "object",
                "additionalProperties": false,
                "properties": {
                  "key": {
                    "type": "string"
                  },
                  "valueExpression": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },
        "userValidationRules": {
          "type": "array",
          "items": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
              "expression": {
                "type": "string"
              },
              "message": {
                "type": "string"
              }
            }
          }
        }
      }
    }
  },
  "required": [
    "image",
    "imagePullPolicy"
  ],
  "additionalProperties": false,
  "properties": {
    "enabled": {
      "type": "boolean",
      "description": "Whether to enable jumpstarter controller"
    },
    "config": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "authentication": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "internal": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "prefix": {
                  "type": "string"
                }
              }
            },
            "jwt": {
              "type": "array",
              "description": "External OIDC authentication, see https://kubernetes.io/docs/reference/access-authn-authz/authentication/#using-authentication-configuration for documentation",
              "items": {
                "$ref": "#/$defs/JWTAuthenticator"
              }
            }
          }
        },
        "grpc": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "keepalive": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "minTime": {
                  "type": "string",
                  "description": "The minimum amount of time a client should wait before sending a keepalive ping"
                },
                "permitWithoutStream": {
                  "type": "boolean",
                  "description": "Whether to allow keepalive pings even when there are no active streams(RPCs)"
                }
              }
            }
          }
        }
      }
    },
    "namespace": {
      "type": "string",
      "description": "Namespace where the controller will be deployed, defaults to global.namespace"
    },
    "image": {
      "type": "string",
      "description": "Image for the controller"
    },
    "tag": {
      "type": "string",
      "description": "Image tag for the controller"
    },
    "imagePullPolicy": {
      "type": "string",
      "description": "Image pull policy for the controller"
    },
    "global": {
      "type": "object",
      "description": "Global parameters",
      "additionalProperties": true,
      "properties": {
        "baseDomain": {
          "type": "string",
          "description": "Base domain to construct the FQDN for the service endpoints"
        },
        "metrics": {
          "types": "object",
          "properties": {
            "enabled": {
              "type": "boolean"
            }
          }
        }
      }
    },
    "grpc": {
      "additionalProperties": false,
      "properties": {
        "hostname": {
          "type": "string",
          "description": "Hostname for the gRPC controller endpoint selfsigned certificates"
        },
        "endpoint": {
          "type": "string",
          "description": "Endpoint to advertise for the gRPC controller endpoint"
        },
        "ingress": {
          "$ref": "#/$defs/ingress"
        },
        "route": {
          "$ref": "#/$defs/route"
        },
        "service": {
          "$ref": "#/$defs/service"
        },
        "tls": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "enabled": {
              "type": "boolean"
            },
            "secret": {
              "type": "string"
            },
            "controllerCertSecret": {
              "type": "string",
              "description": "Secret containing the TLS certificate/key for the gRPC controller endpoint"
            },
            "routerCertSecret": {
              "type": "string",
              "description": "Secret containing the TLS certificate/key for the gRPC router endpoints"
            },
            "port": {
              "$ref": "#/$defs/port",
              "description": "Port to use for the gRPC endpoints Ingress or Route, this can be useful for ingress routers on non-standard ports"
            },
            "mode": {
              "type": "string",
              "description": "TLS mode for gRPC endpoints",
              "enum": [
                "passthrough",
                "reencrypt"
              ]
            }
          }
        },
        "routers": {
          "type": "object",
          "additionalProperties": {
            "$ref": "#/$defs/router"
          }
        }
      }
    }
  }
}
